# -*- coding: utf-8 -*-
"""
Generated by ArcGIS ModelBuilder on : 2023-10-07 11:55:33
"""
# import arcpy
# from .ABCCADDEFG2 import ABCCADDEFG2
# from .ABCCADDEFG2 import ABCCADDEFG2
# from .ABCDEF1 import ABCDEF1
# from sys import argv
import bxarcpy


def main(
    工作空间="C:\\Users\\common\\project\\J江东区临江控规\\临江控规_数据库.gdb",
    输入要素="DIST_用地规划图",
    有扣除地类字段的要素="CZ_三调筛选_有扣除地类用地",
    输出路径=r"DIST_用地规划图_计算耕保量",
):  # 用地_计算耕保量
    # To allow overwriting outputs change overwriteOutput option to True.
    with bxarcpy.环境.环境管理器(临时工作空间=工作空间, 工作空间=工作空间):
        bxarcpy.配置.是否覆盖输出要素(True)

        # # Process: 常用_处理字段并裁剪 (3) (常用_处理字段并裁剪) ()
        # AA_用地规划图_2307251405 = "in_memory\\AA_用地规划图_2307251405"
        # ABCCADDEFG2(规划范围线=JX_规划范围线, DIST_用地规划图=DIST_用地规划图, CZ_单部件__2_=AA_用地规划图_2307251405)

        用地规划图 = 输入要素

        # Process: 筛选 (选择) (analysis)
        输出要素 = bxarcpy.分析.筛选(输入要素=输入要素, SQL语句="地类编号 LIKE '01%'")
        输出要素 = bxarcpy.数据管理.字段删除(输出要素, ["地类编号", "人数公式", "人数指标", "人防公式", "人防指标", "人防规模", "住宅建筑面积", "住宅建筑面积公式", "住宅建筑面积指标", "公服建筑面积", "公服建筑面积公式", "公服建筑面积指标", "兼容比例", "句柄", "同时率", "唯一标识", "商服中办公建筑面积", "商服中办公建筑面积公式", "商服中办公建筑面积指标", "商服中商业建筑面积", "商服中商业建筑面积公式", "商服中商业建筑面积指标", "商服建筑面积", "商服建筑面积公式", "商服建筑面积指标", "固话装机指标", "固话装机量", "固话量公式", "地下空间公式", "地下空间指标", "地下空间规模", "地块建筑面积", "地块性质别称", "地块编号", "地块颜色", "填充图元", "备注说明", "备注说明1", "备注说明2", "备注说明3", "实体GUID", "实体ID", "容积率", "就业人数", "就业公式", "就业指标", "居住人数", "居住户数", "工业建筑面积", "工业建筑面积公式", "工业建筑面积指标", "市政建筑面积", "市政建筑面积公式", "市政建筑面积指标", "建筑密度", "建筑限高", "建筑面积公式", "建筑面积指标", "开发动态", "开口方位", "性质名称", "户数公式", "户数指标", "所属街区", "所属街坊", "控规地块", "数据透视1", "数据透视2", "数据透视3", "有线电视指标", "有线电视量", "机动车位量", "机动车公式", "机动车指标", "污水折算系数", "污水量", "污水量公式", "班数", "用地权属", "用地构成", "用水量", "用水量公式", "用水量指标", "用电负荷指标", "用电负荷量", "用电量公式", "电视量公式", "绝对高度", "绿地率", "绿地面积指定", "绿地面积指定公式", "绿地面积指定指标", "配套设施", "配套设施代码", "配套设施图元", "配套设施规模", "面积公顷", "面积指定", "面积指定公式", "面积指定指标", "高峰机动车分布矩阵", "高峰机动车发生量", "高峰机动车发生量公式", "高峰机动车吸引量", "高峰机动车吸引量公式", "高峰机动车生成量指标", "扣除地类系数"])

        # Process: 相交 (相交) (analysis)
        输出要素 = bxarcpy.分析.相交(输入要素列表=[有扣除地类字段的要素, 输出要素])
        # 输出要素 = bxarcpy.数据管理.字段删除(输入要素=输出要素, 删除字段列表=["Shape_Area"])
        # 输出要素 = bxarcpy.数据管理.字段删除(输出要素, ["Shape_Length_1", "Shape_Area_1"])
        输出要素 = bxarcpy.数据管理.字段删除(输出要素, ["Shape_Length_1", "Shape_Area_1", "Shape_Length", "Shape_Area"])

        # Process: 联合
        输出要素 = bxarcpy.分析.联合(输入要素列表=[用地规划图, 输出要素])
        # 输出要素 = bxarcpy.数据管理.字段删除(输入要素=输出要素, 删除字段列表=["Shape_Area"])
        输出要素 = bxarcpy.数据管理.字段删除(输出要素, ["Shape_Length_1", "Shape_Area_1", "耕地保有量"])
        # print(bxarcpy.数据管理.字段列表获取(输入要素=输出要素))

        输出要素 = bxarcpy.数据管理.字段添加(输入要素=输出要素, 字段名称="耕地保有量", 字段类型="双精度", 字段长度=10)
        from bxpy import 字

        耕地保有量汇总 = 0
        with bxarcpy.数据访问.更新游标(输出要素, ["地类编号", "扣除地类系数", "SHAPE@AREA", "耕地保有量"]) as 游标:
            for x in 游标:
                if 字.匹配正则(x[0], "^01"):
                    耕地保有量 = (1 - x[1]) * x[2]
                    耕地保有量汇总 += 耕地保有量
                    游标.当前行更新([x[0], x[1], x[2], 耕地保有量])
        # 输出要素 = bxarcpy.数据管理.字段计算(输入要素=输出要素, 字段名称="耕地保有量", 表达式="!Shape_area!*(1- !扣除地类系数! )")
        print(f"耕地保有量总和为：{耕地保有量汇总}")
        bxarcpy.数据管理.要素复制(输入要素=输出要素, 输出要素=输出路径)


if __name__ == "__main__":
    # Global Environment settings
    main(
        工作空间="C:\\Users\\common\\project\\J江东区临江控规\\临江控规_数据库.gdb",
        输入要素="DIST_用地规划图",
        有扣除地类字段的要素="CZ_三调筛选_有扣除地类用地",
        输出路径=r"DIST_用地规划图_计算耕保量",
    )
