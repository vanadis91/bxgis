# -*- coding: utf-8 -*-
"""
Generated by ArcGIS ModelBuilder on : 2023-09-25 16:31:40
"""
import bxarcpy


def main(工作空间=r"C:\Users\common\project\J江东区临江控规\临江控规_数据库.gdb", 单元名称="临江单元", 批复时间="", 批复文号="", 道路中线要素名称="DL_道路中线", 道路边线要素名称="DL_道路边线", 高架桥要素名称="GZW_高架桥", 高架桥中心线要素名称="GZW_高架桥中心线", 隧道要素名称=None, 隧道中心线要素名称=None, 河道边线要素名称="DL_河道边线", 河道中线要素名称="DL_河道中线", 地块要素名称="DIST_用地规划图", 铁路线要素名称="GZW_铁路线", 输油管要素名称=None, 高压线要素名称="GZW_高压线", 天然气要素名称="GZW_天然气", 虚位控制河道要素名称="GZW_虚位控制河道", 虚位控制道路要素名称="GZW_虚位控制道路", 绿化控制线要素名称="GZW_绿化控制线"):
    with bxarcpy.环境.环境管理器(临时工作空间=工作空间, 工作空间=工作空间):
        bxarcpy.配置.是否覆盖输出要素 = True
        控制线要素 = bxarcpy.要素类.要素创建_通过名称("XG_KZX", "线")

        控制线要素.字段添加("DYMC", "字符串", 50, "规划编制单元名称").字段计算("DYMC", f"'{单元名称}'")
        控制线要素.字段添加("PFSJ", "日期", None, "批复时间").字段计算("PFSJ", f"'{批复时间}'")
        控制线要素.字段添加("PFWH", "字符串", 50, "批复文号").字段计算("PFWH", f"'{批复文号}'")
        控制线要素.字段添加("LXDM", "字符串", 20, "控制线类型代码")
        控制线要素.字段添加("LXMC", "字符串", 50, "控制线类型名称")
        控制线要素.字段添加("MC", "字符串", 50, "对象名称")

        with bxarcpy.游标类.游标创建_通过名称("插入", 控制线要素.名称, ["_形状", "LXDM", "LXMC", "MC"]) as 游标1:
            道路中线要素 = bxarcpy.要素类.要素读取_通过名称(道路中线要素名称)
            with bxarcpy.游标类.游标创建_通过名称("查询", 道路中线要素.名称, ["_形状", "道路名称", "道路等级"]) as 游标2:
                for x in 游标2:
                    y = {}
                    if x["道路等级"] in ["城市快速路"]:
                        y["LXDM"] = "DLZX-KS"
                        y["LXMC"] = "道路中心线-快速路"
                    elif x["道路等级"] in ["一级城市主干路", "普通城市主干路"]:
                        y["LXDM"] = "DLZX-ZG"
                        y["LXMC"] = "道路中心线-主干路"
                    elif x["道路等级"] in ["城市次干路"]:
                        y["LXDM"] = "DLZX-CG"
                        y["LXMC"] = "道路中心线-次干路"
                    elif x["道路等级"] in ["城市支路"]:
                        y["LXDM"] = "DLZX-ZL"
                        y["LXMC"] = "道路中心线-支路"
                    else:
                        print("未识别到对应的道路等级")
                    y["MC"] = x["道路名称"]
                    y["_形状"] = x["_形状"]
                    游标1.行插入(y)

            道路边线要素 = bxarcpy.要素类.要素读取_通过名称(道路边线要素名称)
            with bxarcpy.游标类.游标创建_通过名称("查询", 道路边线要素.名称, ["_形状", "道路名称", "道路等级"]) as 游标2:
                for x in 游标2:
                    y = {}
                    if x["道路等级"] in ["城市快速路"]:
                        y["LXDM"] = "DLBX-KS"
                        y["LXMC"] = "道路边线-快速路"
                    elif x["道路等级"] in ["一级城市主干路", "普通城市主干路"]:
                        y["LXDM"] = "DLBX-ZG"
                        y["LXMC"] = "道路边线-主干路"
                    elif x["道路等级"] in ["城市次干路"]:
                        y["LXDM"] = "DLBX-CG"
                        y["LXMC"] = "道路边线-次干路"
                    elif x["道路等级"] in ["城市支路"]:
                        y["LXDM"] = "DLBX-ZL"
                        y["LXMC"] = "道路边线-支路"
                    else:
                        print("未识别到对应的道路等级")
                    y["MC"] = x["道路名称"]
                    y["_形状"] = x["_形状"]
                    游标1.行插入(y)

            if 高架桥要素名称:
                高架桥要素 = bxarcpy.要素类.要素读取_通过名称(高架桥要素名称)
                高架桥中心线要素 = bxarcpy.要素类.要素读取_通过名称(高架桥中心线要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 高架桥要素.名称, ["_形状", "道路名称"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "DLBX-GJ"
                        y["LXMC"] = "道路边线-高架"
                        y["MC"] = x["道路名称"]
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)
                with bxarcpy.游标类.游标创建_通过名称("查询", 高架桥中心线要素.名称, ["_形状", "道路名称"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "DLZX-GJ"
                        y["LXMC"] = "道路中心线-高架"
                        y["MC"] = x["道路名称"]
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            if 隧道要素名称:
                隧道要素 = bxarcpy.要素类.要素读取_通过名称(隧道要素名称)
                隧道中心线要素 = bxarcpy.要素类.要素读取_通过名称(隧道中心线要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 隧道要素.名称, ["_形状", "道路名称"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "DLBX-SD"
                        y["LXMC"] = "道路边线-隧道"
                        y["MC"] = x["道路名称"]
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)
                with bxarcpy.游标类.游标创建_通过名称("查询", 隧道中心线要素.名称, ["_形状", "道路名称"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "DLZX-SD"
                        y["LXMC"] = "道路中心线-隧道"
                        y["MC"] = x["道路名称"]
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            河道中线要素 = bxarcpy.要素类.要素读取_通过名称(河道中线要素名称)
            with bxarcpy.游标类.游标创建_通过名称("查询", 河道中线要素.名称, ["_形状", "河道名称"]) as 游标2:
                for x in 游标2:
                    y = {}
                    y["LXDM"] = "HDZX"
                    y["LXMC"] = "河道中心线"
                    y["MC"] = x["河道名称"]
                    y["_形状"] = x["_形状"]
                    游标1.行插入(y)

            河道边线要素 = bxarcpy.要素类.要素读取_通过名称(河道边线要素名称)
            with bxarcpy.游标类.游标创建_通过名称("查询", 河道边线要素.名称, ["_形状", "河道名称"]) as 游标2:
                for x in 游标2:
                    y = {}
                    y["LXDM"] = "HDBX"
                    y["LXMC"] = "河道边线"
                    y["MC"] = x["河道名称"]
                    y["_形状"] = x["_形状"]
                    游标1.行插入(y)

            地块要素 = bxarcpy.要素类.要素读取_通过名称(地块要素名称)
            地块要素 = 地块要素.要素创建_通过面转线(是否识别并存储面邻域信息=False)
            with bxarcpy.游标类.游标创建_通过名称("查询", 地块要素.名称, ["_形状", "地类编号"]) as 游标2:
                from bxpy import bxstr

                for x in 游标2:
                    y = {}
                    if bxstr(x["地类编号"]).匹配正则(r".*(1401|1402).*"):
                        y["LXDM"] = "LHX"
                        y["LXMC"] = "绿化线"
                        y["MC"] = ""
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            if 铁路线要素名称:
                铁路线要素 = bxarcpy.要素类.要素读取_通过名称(铁路线要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 铁路线要素.名称, ["_形状", "铁路名称"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "TL"
                        y["LXMC"] = "铁路"
                        y["MC"] = x["铁路名称"]
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            if 输油管要素名称:
                输油管要素 = bxarcpy.要素类.要素读取_通过名称(输油管要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 输油管要素.名称, ["_形状", "备注"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "SYG"
                        y["LXMC"] = "输油管"
                        y["MC"] = x["备注"]
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            if 高压线要素名称:
                高压线要素 = bxarcpy.要素类.要素读取_通过名称(高压线要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 高压线要素.名称, ["_形状", "电压等级", "备注"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "GYX"
                        y["LXMC"] = "高压线"
                        y["MC"] = x["备注"] + x["电压等级"]
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            if 天然气要素名称:
                天然气要素 = bxarcpy.要素类.要素读取_通过名称(天然气要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 天然气要素.名称, ["_形状", "备注"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "GYX"
                        y["LXMC"] = "高压线"
                        y["MC"] = x["备注"]
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            if 虚位控制河道要素名称:
                虚位控制河道要素 = bxarcpy.要素类.要素读取_通过名称(虚位控制河道要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 虚位控制河道要素.名称, ["_形状"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "XWKZHD"
                        y["LXMC"] = "虚位控制河道"
                        y["MC"] = ""
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            if 绿化控制线要素名称:
                绿化控制线要素 = bxarcpy.要素类.要素读取_通过名称(绿化控制线要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 绿化控制线要素.名称, ["_形状"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "KZLHX"
                        y["LXMC"] = "控制绿化线"
                        y["MC"] = ""
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

            if 虚位控制道路要素名称:
                虚位控制道路要素 = bxarcpy.要素类.要素读取_通过名称(虚位控制道路要素名称)
                with bxarcpy.游标类.游标创建_通过名称("查询", 虚位控制道路要素.名称, ["_形状"]) as 游标2:
                    for x in 游标2:
                        y = {}
                        y["LXDM"] = "XWKZDL"
                        y["LXMC"] = "虚位控制道路"
                        y["MC"] = ""
                        y["_形状"] = x["_形状"]
                        游标1.行插入(y)

        控制线要素.字段删除(保留字段名称列表=["DYMC", "PFSJ", "PFWH", "LXDM", "LXMC", "MC"])
        控制线要素.要素创建_通过复制并重命名重名要素("XG_KZX")


if __name__ == "__main__":
    main(工作空间=r"C:\Users\common\project\J江东区临江控规\临江控规_数据库.gdb", 单元名称="临江单元", 批复时间="", 批复文号="", 道路中线要素名称="DL_道路中线", 道路边线要素名称="DL_道路边线", 高架桥要素名称="GZW_高架桥", 高架桥中心线要素名称="GZW_高架桥中心线", 隧道要素名称=None, 隧道中心线要素名称=None, 河道边线要素名称="DL_河道边线", 河道中线要素名称="DL_河道中线", 地块要素名称="DIST_用地规划图", 铁路线要素名称="GZW_铁路线", 输油管要素名称=None, 高压线要素名称="GZW_高压线", 天然气要素名称="GZW_天然气", 虚位控制河道要素名称="GZW_虚位控制河道", 虚位控制道路要素名称="GZW_虚位控制道路", 绿化控制线要素名称="GZW_绿化控制线")
